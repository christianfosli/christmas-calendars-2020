name: all solutions run without crashing

on: push

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: run all fsharp interactive files
        run: |
          for d in */; do
            pushd "$d"
            for f in *.fsx; do
              printf 'Running %s\n' "$f"
              docker run --rm -v "$(pwd):/app" mcr.microsoft.com/dotnet/sdk:5.0 \
                /bin/bash -c "cd /app && dotnet fsi $f" \
                || (touch /tmp/failures && printf '%s\n' "$f" >> /tmp/failures)
            done
            popd
          done

          if [[ -f /tmp/failures ]]; then
            printf '******\n\n%d tests failed\n\n' "$(wc -l < /tmp/failures)"
            cat /tmp/failures
            exit 1
          fi
